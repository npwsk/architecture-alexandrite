# Планирование: анализ, идентификация проблем и поиск решений

## Проблемы системы

1. Расчёт стоимости в MES может занимать до 30 минут.
2. Первый экран MES долго загружается, несмотря на фильтры и пагинацию.
3. MES развёрнут в одном инстансе — нет масштабируемости и отказоустойчивости.
4. Все приложения имеют по одному инстансу — ограниченная масштабируемость.
5. Каждая база данных имеет один инстанс на чтение и запись — возможны блокировки и узкие места.
6. Рост количества заказов после открытия API привёл к перегрузке системы.
7. Пользователи B2B и B2C жалуются на задержки и потерю заказов.
8. CRM получает заказы через RabbitMQ — возможны потери или задержки сообщений.
9. Отсутствует мониторинг и логирование критических компонентов (MES, RabbitMQ).
10. Ручное тестирование без автоматизации приводит к задержкам релизов.
11. Деплой на продакшн выполняется вручную — риск ошибок.
12. Один QA-инженер не справляется с растущим объёмом задач.
13. Недостаточно разработчиков для поддержки всех компонентов.
14. Недостаток экспертизы по React и C# затрудняет развитие MES.
15. Потеря крупных B2B-клиентов из-за сбоев и задержек.
16. Недовольство клиентов онлайн-магазина растёт.
17. Заказы зависают в промежуточных статусах — нет прозрачности статусов.
18. Операторы не видят новые заказы вовремя — теряют мотивацию.
19. Система не выдерживает линейного роста нагрузки.
20. Нет горизонтального масштабирования для расчётов MES.

## Инициативы, которые необходимы для устранения нежелательных ситуаций

1. Реализация горизонтального масштабирования MES — вынести расчёты стоимости в отдельные воркеры/очереди, масштабируемые по нагрузке.
2. Оптимизация расчётов стоимости — профилировать и ускорить алгоритмы в MES, внедрить кэширование для повторяющихся моделей.
3. Рефакторинг первого экрана MES — оптимизировать запросы, добавить индексы, загрузку по частям (lazy loading).
4. Развёртывание дополнительных инстансов приложений — настроить автошардинг и балансировку нагрузки.
5. Репликация баз данных и разделение чтения/записи — повысит производительность и отказоустойчивость.
6. Добавление dead-letter queue и ретраев в RabbitMQ — для обработки ошибок и повторной доставки сообщений.
7. Внедрение мониторинга и алертинга — для RabbitMQ, MES, CRM, API, производственных процессов.
8. Разработка автоматических E2E-тестов — покрытие критических пользовательских сценариев.
9. Автоматизация деплоя в продакшн через CI/CD — сократить риски и ускорить выпуск.
10. Внедрение очереди заказов с приоритезацией — новые заказы выше в списке операторов.
11. Добавление логирования жизненного цикла заказов — для отслеживания проблем и анализа потерь.
12. Найм дополнительных разработчиков — React/C# для поддержки MES и расширения команды.
13. Усиление QA-команды и автоматизация тестирования — для уменьшения времени на проверки.
14. Обновление API: ограничение нагрузки и rate limiting — защита от перегрузки.
15. Добавление проверки валидности 3D-моделей до отправки в MES — сократить бессмысленные расчёты.
16. Реализация асинхронного API-ответа на расчёт стоимости — чтобы клиент не ждал синхронно.
17. Реализация дашборда контроля всех заказов и статусов — повысить прозрачность для бизнеса и операторов.
18. Анализ SLA и внедрение отчётности по выполнению заказов — контроль качества обслуживания.

## Приоритизация

Приоритизация будет строиться на основе следующих критериев:

- Бизнес-риски: потери клиентов, падение репутации.
- Барьеры масштабирования: технические ограничения, мешающие росту.
- Зависимости: наличие инициатив, блокирующих другие.
- Влияние на пользователей (B2C, B2B, операторов).
- Сложность реализации и ресурсная доступность.

### Приоритизированный список инициатив

**Высший приоритет** (нужно делать сразу):

- Вынесение расчётов MES в воркеры с горизонтальным масштабированием → Устраняет главную техническую точку перегрузки и блокирующую метрику 30 мин.
- Добавление логирования жизненного цикла заказа → Быстро помогает локализовать проблемы «пропавших» заказов.
- Добавление dead-letter queue и ретраев в RabbitMQ → Повышает надёжность взаимодействия между MES и CRM.
- Оптимизация первого экрана MES и упорядочивание отображения заказов по дате → Критично для мотивации операторов и скорости реакции.
- Мониторинг и алертинг критических компонентов → Даст наблюдаемость и позволит реагировать до жалоб пользователей.
- Добавление rate limiting и контроля входящих запросов в API → Защищает систему от перегрузки, особенно со стороны партнёров.

**Средний приоритет** (следующий спринт/квартал):

- Репликация БД и разделение чтения/записи → Повышает производительность при росте нагрузки.
- Разработка E2E-автотестов на критические пути → Уменьшает риск регрессий и ускоряет выпуск.
- Найм разработчиков с опытом React/C# → Устранение узкого места поддержки MES.
- Асинхронный API-ответ от MES на расчёт стоимости → Повышает UX и убирает зависимость от длительного запроса.
- Валидация 3D-моделей до расчёта → Снижает нагрузку на MES от ошибочных моделей.

**Низкий приоритет** (когда основные риски устранены):

- Автоматизация продакшн-деплоя → Удобство и стабильность, но менее критично в краткосроке.
- Дашборд контроля заказов и SLA-отчётность → Повышает управляемость бизнеса, не устраняет технические узлы.
- Очередь заказов с приоритезацией для операторов → Улучшает fairness, но не решает задержки самих заказов.
- Масштабирование всех приложений (не только MES) → Делать после устранения ключевых узких мест.

### Целевая архитектура через полгода

1. Производственный блок MES:
   - Расчёты вынесены в распределённые воркеры.
   - MES может обрабатывать параллельно множество расчётов.
   - Отображение заказов в MES работает быстро и эффективно.

2. Надёжная интеграция через RabbitMQ:
   - С поддержкой dead-letter queue и повторов.
   - Вся цепочка заказа отслеживается и логируется.

3. Наблюдаемость и стабильность:
   - Внедрён алертинг по задержкам расчётов, ошибкам в очередях и пропущенным заказам.
   - Автотесты проверяют критические бизнес-потоки.

4. Масштабируемость и отказоустойчивость:
   - Реплицированные базы, масштабируемые приложения.
   - Ограничение входящей нагрузки через API.

### Топ-3 инициативы на ближайшие полгода

Если выбрать только три:

- Горизонтальное масштабирование расчётов MES → Самая большая точка перегрузки, влияет на весь поток заказов. Без неё всё остальное бессмысленно.
- Логирование жизненного цикла заказов → Даст возможность видеть, где заказы «теряются», и быстро устранить проблемы.
- Добавление ретраев и DLQ в RabbitMQ → Повышает надёжность обмена данными между системами — критично при высокой нагрузке и росте заказов.
